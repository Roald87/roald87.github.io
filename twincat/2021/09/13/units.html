<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<script
  src="https://beamanalytics.b-cdn.net/beam.min.js"
  data-token="cb146bf2-0a6b-412a-93fe-f1b766a68e80"
  async
></script>
<link
  href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700&display=swap"
  rel="stylesheet"
/>
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="shortcut icon" type="image/png" href="/favicon.png" />
<title>How not to screw up your units</title>
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How not to screw up your units | Cook &amp; Code</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="How not to screw up your units" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Units of values are very important, but also easy to screw up. The F# programming language found a nice solution to this problem. Because units are all over the place in an average PLC project, I started to think about how to replicate this behavior in TwinCAT. Eventually I found a method which gives compiler errors if the wrong units are used." />
<meta property="og:description" content="Units of values are very important, but also easy to screw up. The F# programming language found a nice solution to this problem. Because units are all over the place in an average PLC project, I started to think about how to replicate this behavior in TwinCAT. Eventually I found a method which gives compiler errors if the wrong units are used." />
<link rel="canonical" href="https://cookncode.com/twincat/2021/09/13/units.html" />
<meta property="og:url" content="https://cookncode.com/twincat/2021/09/13/units.html" />
<meta property="og:site_name" content="Cook &amp; Code" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-13T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How not to screw up your units" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-08-01T14:25:53+00:00","datePublished":"2021-09-13T00:00:00+00:00","description":"Units of values are very important, but also easy to screw up. The F# programming language found a nice solution to this problem. Because units are all over the place in an average PLC project, I started to think about how to replicate this behavior in TwinCAT. Eventually I found a method which gives compiler errors if the wrong units are used.","headline":"How not to screw up your units","mainEntityOfPage":{"@type":"WebPage","@id":"https://cookncode.com/twincat/2021/09/13/units.html"},"url":"https://cookncode.com/twincat/2021/09/13/units.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
  <body>
    <header class="texture-black">
      <div class="container"><div class="navbar">
	<ul>
		
		<a href="/"><li  >Home</li></a>
		
		<a href="/about"><li  >About</li></a>
		
		<a href="/archive"><li  >Archive</li></a>
		
		<a href="/twincat"><li  >TwinCAT</li></a>
		
		<a href="/cooking"><li  >Cooking</li></a>
		
	</ul>
</div></div><div class="container">
  <h1>How not to screw up your units</h1>
  <div class="post-date" style="margin-top: 20px">
    Published on Sep 13, 2021. Last updated on Aug 1, 2025.
  </div>
  <ul class="post-tags"><li>twincat</li></ul>
</div>
</header>
    <main>
      <div class="container">
        <div class="post-container"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#unit-checks-in-f">Unit checks in F#</a></li>
<li class="toc-entry toc-h2"><a href="#4-putting-units-in-comments">4. Putting units in comments</a></li>
<li class="toc-entry toc-h2"><a href="#3-using-aliases">3. Using aliases</a></li>
<li class="toc-entry toc-h2"><a href="#2-add-unit-to-the-variable-name">2. Add unit to the variable name</a></li>
<li class="toc-entry toc-h2"><a href="#1-using-structs">1. Using structs</a>
<ul>
<li class="toc-entry toc-h3"><a href="#adding-unit-string-as-payload">Adding unit string as payload</a></li>
<li class="toc-entry toc-h3"><a href="#adding-io-signal-status">Adding IO signal status</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#conclusions">Conclusions</a></li>
</ul><p>Units of values are very important, but also easy to screw up. The F# programming language found a nice solution to this problem. Because units are all over the place in an average PLC project, I started to think about how to replicate this behavior in TwinCAT. Eventually I found a method which gives compiler errors if the wrong units are used.</p>

<ul>
  <li>Example code: <a href="https://github.com/Roald87/TwincatTutorials/tree/main/Units">GitHub repo</a>, <a href="https://downgit.github.io/#/home?url=https://github.com/Roald87/TwincatTutorials/tree/main/Units">direct download</a>.</li>
</ul>

<p>Back when I had my first science classes, the teachers would always emphasize the importance of units. If I forgot them, points were usually subtracted from my final mark. At the time I always found this a bit unreasonable. I was calculating a speed, of course the units would be in km/h!</p>

<p>Over the years I got wiser and started to get the importance of what units are used. I learned that things can go horribly wrong when this is not done. For example, the <a href="https://en.wikipedia.org/wiki/Mars_Climate_Orbiter">Mars Climate Orbiter</a> failed to go into orbit around the red planet, because of a <a href="https://edition.cnn.com/TECH/space/9909/30/mars.metric.02/index.html">mix-up between metric and imperial units</a>.</p>

<p>Now, most of us are not working with hundred million dollar machines which try to orbit a distant planet. But also for less expensive machines on earth it would be nice to not make these mistakes. Below I‚Äôll show the different options I thought of how to prevent unit mix-ups. They are ranked from worst to best, according to my opinion.</p>

<h2 id="unit-checks-in-f">
<a class="anchor" href="#unit-checks-in-f" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unit checks in F#</h2>

<p>Before diving into how unit checks can be done in TwinCAT, let me first show you how unit checks are done in F#. In F# a unit can be defined using the following syntax.</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[&lt;</span><span class="nc">Measure</span><span class="p">&gt;]</span> <span class="k">type</span> <span class="nc">Celsius</span>
<span class="p">[&lt;</span><span class="nc">Measure</span><span class="p">&gt;]</span> <span class="k">type</span> <span class="nc">Fahrenheit</span>
</code></pre></div></div>

<p>These units can be used in functions. For example, below a function is defined with <code class="language-plaintext highlighter-rouge">let</code> called <code class="language-plaintext highlighter-rouge">CelsiusToFahrenheit</code>. It has a single input argument called <code class="language-plaintext highlighter-rouge">temperature</code>. Inside the function the conversion takes place using the units defined above. The units are placed between angle brackets <code class="language-plaintext highlighter-rouge">&lt;</code> and <code class="language-plaintext highlighter-rouge">&gt;</code>.</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nc">CelsiusToFahrenheit</span> <span class="n">temperature</span> <span class="p">=</span>
    <span class="n">temperature</span> <span class="p">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">8</span><span class="p">&lt;</span><span class="nc">Fahrenheit</span><span class="o">/</span><span class="nc">Celsius</span><span class="p">&gt;</span> <span class="o">+</span> <span class="mi">32</span><span class="p">.</span><span class="mi">0</span><span class="p">&lt;</span><span class="nc">Fahrenheit</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>The unit of <code class="language-plaintext highlighter-rouge">temperature</code> does not need to be supplied, as these will be inferred by the compiler from the units of the variables inside. Now, if we would like to use this function, we also have to use the correct input units.</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&gt;</span> <span class="nc">CelsiusToFahrenheit</span> <span class="mi">21</span><span class="p">.</span><span class="mi">0</span><span class="p">&lt;</span><span class="nc">Celsius</span><span class="o">&gt;;;</span>
<span class="k">val</span> <span class="n">it</span> <span class="p">:</span> <span class="kt">float</span><span class="p">&lt;</span><span class="nc">Fahrenheit</span><span class="p">&gt;</span> <span class="p">=</span> <span class="mi">69</span><span class="p">.</span><span class="mi">8</span>
</code></pre></div></div>

<p>If we use the wrong units the compiler will complain.</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&gt;</span> <span class="nc">CelsiusToFahrenheit</span> <span class="mi">62</span><span class="p">.</span><span class="mi">0</span><span class="p">&lt;</span><span class="nc">Fahrenheit</span><span class="o">&gt;;;</span>

  <span class="nc">CelsiusToFahrenheit</span> <span class="mi">62</span><span class="p">.</span><span class="mi">0</span><span class="p">&lt;</span><span class="nc">Fahrenheit</span><span class="o">&gt;;;</span>
  <span class="o">--------------------^^^^^^^^^^^^^^^^</span>

<span class="n">stdin</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">21</span><span class="o">):</span> <span class="n">error</span> <span class="nc">FS0001</span><span class="p">:</span> <span class="nc">Type</span> <span class="n">mismatch</span><span class="p">.</span> <span class="nc">Expecting</span> <span class="n">a</span>
    <span class="k">'</span><span class="kt">float</span><span class="p">&lt;</span><span class="nc">Celsius</span><span class="p">&gt;</span><span class="k">'</span>
<span class="n">but</span> <span class="n">given</span> <span class="n">a</span>
    <span class="k">'</span><span class="kt">float</span><span class="p">&lt;</span><span class="nc">Fahrenheit</span><span class="p">&gt;</span><span class="k">'</span>
<span class="nc">The</span> <span class="kt">unit</span> <span class="k">of</span> <span class="n">measure</span> <span class="k">'</span><span class="nc">Celsius'</span> <span class="n">does</span> <span class="k">not</span> <span class="k">match</span> <span class="n">the</span> <span class="kt">unit</span> <span class="k">of</span> <span class="n">measure</span> <span class="k">'</span><span class="nc">Fahrenheit'</span>
</code></pre></div></div>

<p>Likewise, if the unit is omitted we also get a compiler error.</p>

<div class="language-fsharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&gt;</span> <span class="nc">CelsiusToFahrenheit</span> <span class="mi">94</span><span class="p">.</span><span class="mi">0</span><span class="p">;;</span>

  <span class="nc">CelsiusToFahrenheit</span> <span class="mi">94</span><span class="p">.</span><span class="mi">0</span><span class="p">;;</span>
  <span class="o">--------------------^^^^</span>

<span class="n">stdin</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">21</span><span class="o">):</span> <span class="n">error</span> <span class="nc">FS0001</span><span class="p">:</span> <span class="nc">This</span> <span class="n">expression</span> <span class="n">was</span> <span class="n">expected</span> <span class="k">to</span> <span class="n">have</span> <span class="k">type</span>
    <span class="k">'</span><span class="kt">float</span><span class="p">&lt;</span><span class="nc">Celsius</span><span class="p">&gt;</span><span class="k">'</span>
<span class="n">but</span> <span class="n">here</span> <span class="n">has</span> <span class="k">type</span>
    <span class="k">'</span><span class="n">float'</span>
</code></pre></div></div>

<p>I think this is a very useful feature. If you want to learn more about it, you can read an excellent overview in <a href="https://fsharpforfunandprofit.com/posts/units-of-measure/">F# for Fun and Profit</a>. Now let‚Äôs explore how this functionality can be implemented in TwinCAT!</p>

<h2 id="4-putting-units-in-comments">
<a class="anchor" href="#4-putting-units-in-comments" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Putting units in comments</h2>

<p>Probably the most commonly used method is to put the units of a variable in the comment. For example</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maximumPressure : REAL; // [mbar]
</code></pre></div></div>

<p>However, it is very hard to spot a mistake as shown by the following example.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PROGRAM MAIN
VAR
	pressure1 : REAL; // [mbar]
	pressure2 : REAL; // [Torr]
END_VAR

pressure2 := TorrToMbar(pressure1);
</code></pre></div></div>

<p>The pros and cons of this method are:</p>

<p>‚úîÔ∏è There is a unit.</p>

<p>‚ùå Need to hover over it to see the unit.</p>

<p><a href="/assets/2021-09-13-units/mouse_hover_unit.png"><picture><source srcset="/generated/2021-09-13-units/mouse_hover_unit-269-011cdd5c4.webp 269w" type="image/webp"><source srcset="/generated/2021-09-13-units/mouse_hover_unit-269-65fb960f1.png 269w" type="image/png"><img src="/generated/2021-09-13-units/mouse_hover_unit-269-65fb960f1.png" alt="showing the unit from the comment with a mouse hoover" width="269" height="73"></source></source></picture></a></p>

<p>‚ùå No automatic checks to ensure the right unit is used.</p>

<h2 id="3-using-aliases">
<a class="anchor" href="#3-using-aliases" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Using aliases</h2>

<p><a href="https://infosys.beckhoff.com/english.php?content=../content/1033/tc3_plc_intro/3928317323.html&amp;id=">Aliases</a> can be used to define a unit. An alias is just another name for a standard data type. Some standard TwinCAT aliases you might have seen are <code class="language-plaintext highlighter-rouge">T_MaxString</code> = <code class="language-plaintext highlighter-rouge">STRING(255)</code> or <code class="language-plaintext highlighter-rouge">FLOAT</code> = <code class="language-plaintext highlighter-rouge">REAL</code>.</p>

<p>An alias can be created by right clicking on the PLC project and choose <strong>Add &gt; DUT</strong>. Then in the following screen select Alias and give it a name (e.g. mbar) and a datatype (e.g. <code class="language-plaintext highlighter-rouge">REAL</code>).</p>

<p><a href="/assets/2021-09-13-units/create_alias.png"><picture><source srcset="/generated/2021-09-13-units/create_alias-300-523c6ee5a.webp 300w, /generated/2021-09-13-units/create_alias-346-523c6ee5a.webp 346w" type="image/webp"><source srcset="/generated/2021-09-13-units/create_alias-300-97be2080e.png 300w, /generated/2021-09-13-units/create_alias-346-97be2080e.png 346w" type="image/png"><img src="/generated/2021-09-13-units/create_alias-346-97be2080e.png" alt="how to create an alias data type" width="346" height="480"></source></source></picture></a></p>

<p>Then it can be used as follows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PROGRAM MAIN
VAR
	pressure_si : mbar;
    pressure_imperial : Torr;
END_VAR

pressure_si := TorrToMbarWithAlias(pressure:=pressure_imperial);
</code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">TorrToMbarWithAlias</code> is defined as</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FUNCTION TorrToMbarWithAlias : mbar
VAR_INPUT
    pressure : Torr;
END_VAR

TorrToMbarWithAlias := pressure * 1.3332236842;
</code></pre></div></div>

<p>At the first glance this looks very similar to the F# approach. However, the aliases are just a different name for the underlying datatype. The compiler only checks that the underlying datatype (<code class="language-plaintext highlighter-rouge">REAL</code> in this case), is correct. So the following would be possible:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pressure_in_torr := TorrToMbarWithAlias(pressure:=pressure_in_mbar);
</code></pre></div></div>

<p>Concluding</p>

<p>‚úîÔ∏è There is a unit.</p>

<p>‚ùå Need to hover over it to see the unit.</p>

<p>‚ùå Compiler doesn‚Äôt complain if the wrong alias is used.</p>

<h2 id="2-add-unit-to-the-variable-name">
<a class="anchor" href="#2-add-unit-to-the-variable-name" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Add unit to the variable name</h2>

<p>Another option would be to append the unit to the variable name:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>maximumPressure_mbar : REAL;
</code></pre></div></div>

<p>This method also doesn‚Äôt have any automatic check to prevent unit mix-ups. But the following mistake is harder to make, because the input variable‚Äôs unit doesn‚Äôt match the argument name one.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PROGRAM MAIN
VAR
    pressure1_mbar : REAL;
    pressure2_Torr : REAL;
END_VAR

pressure2_Torr := TorrToMbarWithUnits(pressure_Torr:=pressure1_mbar);
</code></pre></div></div>

<p>‚úîÔ∏è There is a unit.</p>

<p>‚úîÔ∏è No need to hover over it to see the unit.</p>

<p>‚ùå No automatic checks to ensure the right unit is used.</p>

<h2 id="1-using-structs">
<a class="anchor" href="#1-using-structs" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Using structs</h2>

<p>We‚Äôre making progress, but the compiler is not helping us yet. In order for the compiler to help us, STRUCTs can be used. You can add a STRUCT by right clicking on your PLC project and selecting <strong>Add &gt; DUT</strong>.</p>

<p><a href="/assets/2021-09-13-units/create_struct.png"><picture><source srcset="/generated/2021-09-13-units/create_struct-300-a03d6e686.webp 300w, /generated/2021-09-13-units/create_struct-346-a03d6e686.webp 346w" type="image/webp"><source srcset="/generated/2021-09-13-units/create_struct-300-1811523bd.png 300w, /generated/2021-09-13-units/create_struct-346-1811523bd.png 346w" type="image/png"><img src="/generated/2021-09-13-units/create_struct-346-1811523bd.png" alt="how to create a struct" width="346" height="480"></source></source></picture></a></p>

<p>And then define the STRUCTs as follows.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE Pascal :
STRUCT
    _ : REAL;
END_STRUCT
END_TYPE
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE PoundsPerSquareInch :
STRUCT
     _ : REAL;
END_STRUCT
END_TYPE
</code></pre></div></div>

<p>We then add a conversion function.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FUNCTION PoundsPerSquareInchToPascal : Pascal
VAR_INPUT
    pressure : PoundsPerSquareInch;
END_VAR

PoundsPerSquareInchToPascal._ := pressure._ * 6895;
</code></pre></div></div>

<p>If we try to run this function with the wrong units:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PROGRAM MAIN
VAR
    pressure_eu : Pascal;
    pressure_us : PoundsPerSquareInch;
END_VAR

pressure_us := PoundsPerSquareInchToPascal(pressure:=pressure_eu);
</code></pre></div></div>

<p>the compiler will complain. üôå</p>

<p><a href="/assets/2021-09-13-units/convert_type_error.png"><picture><source srcset="/generated/2021-09-13-units/convert_type_error-300-5675a09ad.webp 300w, /generated/2021-09-13-units/convert_type_error-420-5675a09ad.webp 420w" type="image/webp"><source srcset="/generated/2021-09-13-units/convert_type_error-300-626257858.png 300w, /generated/2021-09-13-units/convert_type_error-420-626257858.png 420w" type="image/png"><img src="/generated/2021-09-13-units/convert_type_error-420-626257858.png" alt="compiler error from using the wrong struct" width="420" height="42"></source></source></picture></a></p>

<p>‚úîÔ∏è There is a unit.</p>

<p>‚ùå Need to hover over it to see the unit, but this is a minor issue since the compiler will check it for us.</p>

<p>‚úîÔ∏è Compiler complains if the wrong type is used.</p>

<p>‚ùå The interface is not very convenient, since we have to append <code class="language-plaintext highlighter-rouge">._</code> each time we want to access the value.</p>

<h3 id="adding-unit-string-as-payload">
<a class="anchor" href="#adding-unit-string-as-payload" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding unit string as payload</h3>

<p>Using structs gives us a major advantage since the compiler will help us. However, it feels a bit excessive to define a whole struct for this and then we have to use the <code class="language-plaintext highlighter-rouge">._</code> to assign or use the variable inside. We can ease the pain a bit by adding some useful information to the struct. For example, we could add the units to the struct in string format. This string could then be used in the HMI for example.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE mmHg :
STRUCT
    _ : REAL;
    unit : STRING := 'mmHg';
END_STRUCT
END_TYPE
</code></pre></div></div>

<p><a href="/assets/2021-09-13-units/struct_with_string_unit.png"><picture><source srcset="/generated/2021-09-13-units/struct_with_string_unit-300-9b2eaff5f.webp 300w, /generated/2021-09-13-units/struct_with_string_unit-439-9b2eaff5f.webp 439w" type="image/webp"><source srcset="/generated/2021-09-13-units/struct_with_string_unit-300-43582513b.png 300w, /generated/2021-09-13-units/struct_with_string_unit-439-43582513b.png 439w" type="image/png"><img src="/generated/2021-09-13-units/struct_with_string_unit-439-43582513b.png" alt="a struct with a unit as a string" width="439" height="64"></source></source></picture></a></p>

<h3 id="adding-io-signal-status">
<a class="anchor" href="#adding-io-signal-status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding IO signal status</h3>

<p>Another option could be to add some information about the state of the input signal. Terminals usually have a WcState variable. This variable shows if the terminal cyclically exchanges data with the master and does this without errors. Furthermore, some input channels also have a state, which can show if there is an open circuit, short circuit or some other irregularity.</p>

<p>To capture the terminal status we make a new struct.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE TerminalStatus :
STRUCT
    WorkingCounterError : BOOL;
    IOError : BOOL;
END_STRUCT
END_TYPE
</code></pre></div></div>

<p>Then whenever we define a new unit, we extend the struct above.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TYPE Celsius EXTENDS TerminalStatus :
STRUCT
    _ : REAL;
END_STRUCT
END_TYPE
</code></pre></div></div>

<p>In order to check whether a signal is valid, we can define a new function. The function uses the general <code class="language-plaintext highlighter-rouge">TerminalStatus</code> as its input type. That way this function can be called with extended structs, such as <code class="language-plaintext highlighter-rouge">Celsius</code>, as I <a href="https://cookncode.com/twincat/2021/04/20/overloading-with-extended-structs.html">wrote about in an earlier article</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FUNCTION IsValid : BOOL
VAR_INPUT
    status : TerminalStatus;
END_VAR

IsValid := NOT (status.IOError OR status.WorkingCounterError);
</code></pre></div></div>

<p>Finally we define a conversion function, where we only convert the temperature if the signal state is ok.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FUNCTION FahrenheitToCelsius : Celsius
VAR_INPUT
    temperature : Fahrenheit;
END_VAR

FahrenheitToCelsius.IOError := temperature.IOError;
FahrenheitToCelsius.WorkingCounterError := temperature.WorkingCounterError;
IF IsValid(temperature) THEN
    FahrenheitToCelsius._ := (temperature._ - 32) /  1.8;
END_IF
</code></pre></div></div>

<p>After activating this code we can see it in action.</p>

<p><img src="/assets/2021-09-13-units/toggle_valid_signal.gif" alt="toggling of the validity of the input signal"></p>

<h2 id="conclusions">
<a class="anchor" href="#conclusions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusions</h2>

<p>In the end we came quite close to the F# unit checks implementation. Although the intermediate conversions, such as the 32 in <code class="language-plaintext highlighter-rouge">FahrenheitToCelsius</code>, are not checked by the compiler as in F#. But these intermediate conversions can be checked relatively easy with unit tests. What is checked with the method above are the in and outputs of the function. I would argue this is the most important part, since they usually need <a href="https://cookncode.com/twincat/2021/08/17/tc-simulation.html">integration tests</a>. Finally the interface of a custom struct is not the most convenient, but I showed some examples how you could soften the pain by adding some useful information to the unit structs.</p>
</div><!-- prettier-ignore

-->


<div class="article_previous_next">
  <a href="/twincat/2021/08/17/tc-simulation.html">‚ùÆ Machine simulation with a digital twin</a>
</div>
 
<div class="article_next">
  <a href="/twincat/2022/01/09/tc-quicktips.html">Tips and tricks for TwinCAT ‚ùØ</a>
</div>

<div style="margin-bottom: 25px">
          Like my work?
          <a href="https://ko-fi.com/roald87">Consider a donation!</a>
        </div>
        <div id="disqus_thread" style="margin-top: 25px">
          <script
            src="https://utteranc.es/client.js"
            repo="Roald87/roald87.github.io"
            issue-term="pathname"
            label="comment"
            theme="boxy-light"
            crossorigin="anonymous"
            async
          ></script>
        </div>
      </div>
    </main></body>
</html>
